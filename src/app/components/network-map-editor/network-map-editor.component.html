<!-- Minimal Header for Full-Screen Map Editor -->
<div class="bg-slate-900 text-white p-3 flex items-center justify-between border-b border-slate-700">
  <div class="flex items-center gap-3">
    <div class="w-8 h-8 bg-teal-600 rounded-lg flex items-center justify-center">
      <i class="pi pi-sitemap text-sm"></i>
    </div>
    <h2 class="text-md font-bold tracking-tight">Netzeditor</h2>
  </div>
  <a routerLink="/" class="text-slate-400 hover:text-white transition-colors text-sm flex items-center gap-1">
    <i class="pi pi-home"></i> Zur Startseite
  </a>
</div>


<div class="relative w-full h-[calc(100vh-64px)] overflow-hidden">
  <!-- Editor Mode Toolbar -->
  <div
    class="absolute top-4 left-4 z-[1000] flex items-center bg-slate-900/80 backdrop-blur-md p-2 rounded-xl border border-slate-700 shadow-2xl">
    <div class="flex p-1 bg-slate-800 rounded-lg mr-4">
      <button type="button" class="px-4 py-2 rounded-md text-sm font-medium transition-all duration-200"
        [class.bg-blue-600.text-white.shadow-lg]="editorMode === 'distance'"
        [class.text-slate-400.hover:text-white]="editorMode !== 'distance'" (click)="setEditorMode('distance')">
        üìè Messen
      </button>
      <button type="button" class="px-4 py-2 rounded-md text-sm font-medium transition-all duration-200"
        [class.bg-amber-600.text-white.shadow-lg]="editorMode === 'ortsmarke'"
        [class.text-slate-400.hover:text-white]="editorMode !== 'ortsmarke'" (click)="setEditorMode('ortsmarke')">
        üìç Ortsmarke
      </button>
    </div>

    <div class="flex items-center gap-4 text-xs font-semibold text-slate-300 pr-2 border-l border-slate-700 pl-4">
      <div class="flex items-center gap-1.5">
        <span class="w-2.5 h-2.5 rounded-full bg-sky-500 shadow-[0_0_8px_rgba(14,165,233,0.5)]"></span> Steig
      </div>
      <div class="flex items-center gap-1.5">
        <span class="w-2.5 h-2.5 rounded-full bg-amber-500 shadow-[0_0_8px_rgba(245,158,11,0.5)]"></span> Ortsmarke
      </div>
      <div class="flex items-center gap-1.5">
        <span class="w-4 h-0.5 bg-emerald-500 rounded-full"></span> Relation
      </div>
    </div>
  </div>

  <div id="map" class="w-full h-full"></div>

  <!-- Distance Editor Panel -->
  <div
    class="absolute top-20 right-4 z-[1000] w-80 bg-slate-900/90 backdrop-blur-xl rounded-2xl border border-slate-700 shadow-2xl overflow-hidden transition-all duration-300"
    *ngIf="editorMode === 'distance' && selectedOriginStop">
    <div class="flex items-center justify-between px-5 py-4 bg-blue-600/20 border-b border-blue-500/30">
      <h3 class="text-white font-semibold flex items-center gap-2">
        <span class="text-blue-400">üìè</span> Strecke messen
      </h3>
      <button class="text-slate-400 hover:text-white transition-colors" (click)="clearSelection()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd" />
        </svg>
      </button>
    </div>
    <div class="p-5 space-y-4">
      <div class="space-y-1">
        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Startpunkt</label>
        <div class="text-sm text-white font-medium truncate">{{ selectedOriginStop.ORT_NAME }}</div>
        <div class="text-[10px] text-slate-400 flex justify-between gap-2">
          <span>Ort NR: {{ selectedOriginStop.ORT_NR }}</span>
          <span class="font-mono opacity-60 truncate">{{ selectedOriginStop.HST_NR_INTERNATIONAL }}</span>
        </div>
      </div>

      <div class="relative py-2 pl-3 border-l-2 border-slate-700 ml-1">
        <div class="absolute -left-[5px] top-0 w-2 h-2 rounded-full bg-slate-700"></div>
        <div class="absolute -left-[5px] bottom-0 w-2 h-2 rounded-full bg-slate-700"></div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-500 my-1" fill="none" viewBox="0 0 24 24"
          stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
        </svg>
      </div>

      <div class="space-y-1">
        <label class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Zielpunkt</label>
        <div class="text-sm font-medium" [class.text-white]="selectedDestinationStop"
          [class.text-slate-500]="!selectedDestinationStop">
          {{ selectedDestinationStop?.ORT_NAME || 'Ziel auf Karte w√§hlen...' }}
        </div>
        <div class="text-[10px] text-slate-400 flex justify-between gap-2" *ngIf="selectedDestinationStop">
          <span>Ort NR: {{ selectedDestinationStop.ORT_NR }}</span>
          <span class="font-mono opacity-60 truncate">{{ selectedDestinationStop.HST_NR_INTERNATIONAL }}</span>
        </div>
      </div>

      <div class="pt-2">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-2">Distance
          (Meter)</label>
        <div class="flex gap-2">
          <input type="number"
            class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-blue-500 transition-colors"
            [(ngModel)]="distance">
          <button (click)="getDistanceFromEfa()" [disabled]="!selectedDestinationStop"
            class="bg-slate-800 hover:bg-slate-700 disabled:opacity-50 text-blue-400 p-2 rounded-lg border border-slate-700 transition-all active:scale-95"
            title="Abstand via EFA berechnen">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd"
                d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>

      <button
        class="w-full bg-blue-600 hover:bg-blue-500 disabled:bg-slate-800 disabled:text-slate-600 text-white font-semibold py-2.5 rounded-xl transition-all shadow-lg shadow-blue-600/20 active:scale-[0.98]"
        [disabled]="!selectedDestinationStop" (click)="saveDistance()">
        Relation Speichern
      </button>
    </div>
  </div>

  <!-- Ortsmarke Editor Panel -->
  <div
    class="absolute top-20 right-4 z-[1000] w-80 bg-slate-900/90 backdrop-blur-xl rounded-2xl border border-slate-700 shadow-2xl overflow-hidden"
    *ngIf="editorMode === 'ortsmarke' && newOrtsmarkePosition">
    <div class="flex items-center justify-between px-5 py-4 bg-amber-600/20 border-b border-amber-500/30">
      <h3 class="text-white font-semibold flex items-center gap-2">
        <span class="text-amber-400">üìç</span> Neue Ortsmarke
      </h3>
      <button class="text-slate-400 hover:text-white transition-colors" (click)="clearNewOrtsmarke()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd" />
        </svg>
      </button>
    </div>
    <div class="p-5 space-y-4">
      <div class="text-[10px] text-slate-500 font-mono tracking-tighter bg-slate-950/50 p-2 rounded-md">
        COORDS: {{ newOrtsmarkePosition.lat.toFixed(6) }}, {{ newOrtsmarkePosition.lng.toFixed(6) }}
      </div>

      <div class="space-y-1">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest">Referenz-Ort</label>
        <select
          class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-amber-500 transition-colors text-sm"
          [(ngModel)]="newOrtsmarke.ORT_NR" [ngModelOptions]="{standalone: true}">
          <option [ngValue]="undefined">-- Ort w√§hlen --</option>
          <option *ngFor="let stop of stops" [ngValue]="stop.ORT_NR">{{ stop.ORT_NR }} - {{ stop.ORT_NAME }}</option>
        </select>
      </div>

      <div class="space-y-1">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest">Anzeigename</label>
        <input type="text" placeholder="z.B. Haupteingang"
          class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-amber-500 transition-colors text-sm"
          [(ngModel)]="newOrtsmarke.ORM_TEXT" [ngModelOptions]="{standalone: true}" maxlength="40">
      </div>

      <div class="space-y-1">
        <label class="block text-[10px] font-bold text-slate-500 uppercase tracking-widest">K√ºrzel</label>
        <input type="text" placeholder="HE"
          class="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-amber-500 transition-colors text-sm"
          [(ngModel)]="newOrtsmarke.ORM_KUERZEL" [ngModelOptions]="{standalone: true}" maxlength="6">
      </div>

      <button
        class="w-full bg-amber-600 hover:bg-amber-500 disabled:bg-slate-800 disabled:text-slate-600 text-white font-semibold py-2.5 rounded-xl transition-all shadow-lg shadow-amber-600/20 active:scale-[0.98]"
        [disabled]="!newOrtsmarke.ORT_NR" (click)="saveOrtsmarke()">
        Ortsmarke speichern
      </button>
    </div>
  </div>

  <!-- Hint when in Ortsmarke mode but no position selected -->
  <div
    class="absolute top-20 right-4 z-[1000] flex items-center gap-3 bg-amber-600 text-white px-5 py-3 rounded-xl shadow-2xl animate-bounce"
    *ngIf="editorMode === 'ortsmarke' && !newOrtsmarkePosition">
    <span class="text-xl">üñ±Ô∏è</span>
    <p class="font-medium text-sm">Klicke auf die Karte, um eine neue Ortsmarke zu platzieren</p>
  </div>
</div>