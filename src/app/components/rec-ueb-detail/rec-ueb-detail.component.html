<div class="flex flex-col h-full bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">

    <!-- Header -->
    <div class="flex items-center justify-between p-4 border-b border-slate-100 bg-slate-50/50">
        <div class="flex items-center gap-4">
            <a routerLink="/rec-ueb">
                <p-button icon="pi pi-arrow-left" [text]="true" severity="secondary"></p-button>
            </a>
            <div>
                <h2 class="text-lg font-bold text-slate-800 tracking-tight">{{ isNew ? 'Neuer Übergang' : 'Übergang
                    bearbeiten' }}</h2>
            </div>
        </div>
        <div class="flex gap-2">
            <p-button label="Speichern" icon="pi pi-check" severity="success" (onClick)="save()"></p-button>
        </div>
    </div>

    <div class="flex-1 overflow-auto bg-slate-50 p-4">
        <div class="max-w-4xl mx-auto flex flex-col gap-6">

            <!-- Meta Card -->
            <p-card styleClass="shadow-sm border border-slate-200 rounded-xl overflow-hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

                    <!-- Basis Version -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-medium text-slate-700">Basis Version</label>
                        <p-inputNumber [(ngModel)]="item.BASIS_VERSION" [disabled]="!isNew" [useGrouping]="false"
                            styleClass="w-full" class="w-full block"></p-inputNumber>
                    </div>

                    <!-- Bereich Nr -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-medium text-slate-700">Bereich Nr</label>
                        <p-inputNumber [(ngModel)]="item.BEREICH_NR" [disabled]="!isNew" [useGrouping]="false"
                            styleClass="w-full" class="w-full block"></p-inputNumber>
                    </div>

                    <!-- Von Ort -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-medium text-slate-700">Von Ort (Nr)</label>
                        <p-dropdown [options]="stops" [(ngModel)]="item.ORT_NR" optionLabel="ORT_NAME"
                            optionValue="ORT_NR" [filter]="true" filterBy="ORT_NAME,ORT_NR" [virtualScroll]="true"
                            [itemSize]="30" placeholder="Wähle Ort" styleClass="w-full"
                            [disabled]="!isNew"></p-dropdown>
                    </div>

                    <!-- Nach Ort -->
                    <div class="flex flex-col gap-2">
                        <label class="text-sm font-medium text-slate-700">Nach Ort (Nr)</label>
                        <p-dropdown [options]="stops" [(ngModel)]="item.UEB_ZIEL" optionLabel="ORT_NAME"
                            optionValue="ORT_NR" [filter]="true" filterBy="ORT_NAME,ORT_NR" [virtualScroll]="true"
                            [itemSize]="30" placeholder="Wähle Zielort" styleClass="w-full"
                            [disabled]="!isNew"></p-dropdown>
                    </div>

                    <!-- Length -->
                    <div class="flex flex-col gap-2 md:col-span-2">
                        <label class="text-sm font-medium text-slate-700">Länge (Meter)</label>
                        <p-inputNumber [(ngModel)]="item.UEB_LAENGE" suffix=" m" styleClass="w-full"
                            class="w-full block"></p-inputNumber>
                    </div>
                </div>

                <div class="mt-6 flex justify-end" *ngIf="!isNew">
                    <p-button label="Löschen" icon="pi pi-trash" severity="danger" [outlined]="true"
                        (onClick)="delete()"></p-button>
                </div>
            </p-card>

            <!-- Fahrzeiten (UEB_FZT) Section -->
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mt-4">
                <div class="p-4 border-b border-slate-100 bg-slate-50/50 flex items-center justify-between">
                    <h3 class="text-lg font-bold text-slate-800">Fahrzeiten (UEB_FAHRZEIT)</h3>
                </div>

                <div class="p-6 border-b border-slate-100 bg-slate-50/20">
                    <h4 class="text-sm font-bold text-slate-700 mb-4">Neue Fahrzeit hinzufügen</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div class="flex flex-col gap-2">
                            <label class="text-xs font-medium text-slate-500 uppercase">Tagesart</label>
                            <p-dropdown [options]="tagesarten" [(ngModel)]="newFzt.TAGESART_NR"
                                optionLabel="TAGESART_TEXT" optionValue="TAGESART_NR" placeholder="Tagesart"
                                styleClass="w-full" appendTo="body"></p-dropdown>
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-xs font-medium text-slate-500 uppercase">Fahrzeitgruppe (FGR)</label>
                            <p-inputNumber [(ngModel)]="newFzt.FGR_NR" [useGrouping]="false" styleClass="w-full"
                                class="w-full block"></p-inputNumber>
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-xs font-medium text-slate-500 uppercase">Zeit (Sekunden)</label>
                            <p-inputNumber [(ngModel)]="newFzt.UEB_FAHRZEIT" suffix=" s" styleClass="w-full"
                                class="w-full block"></p-inputNumber>
                        </div>
                        <div>
                            <p-button label="Hinzufügen" icon="pi pi-plus" (onClick)="addFzt()"
                                styleClass="w-full"></p-button>
                        </div>
                    </div>
                </div>

                <div class="p-0">
                    <p-table [value]="item.uebFzts || []" styleClass="p-datatable-sm p-datatable-striped"
                        [rowHover]="true">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Tagesart</th>
                                <th>FGR</th>
                                <th>Fahrzeit</th>
                                <th class="text-right">Aktionen</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-fzt let-rowIndex="rowIndex">
                            <tr>
                                <td>{{ fzt.TAGESART_NR }}</td>
                                <td>{{ fzt.FGR_NR }}</td>
                                <td class="font-bold text-indigo-600">{{ fzt.UEB_FAHRZEIT }}s</td>
                                <td class="text-right">
                                    <p-button icon="pi pi-trash" [text]="true" severity="danger" size="small"
                                        (onClick)="removeFzt(rowIndex)"></p-button>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="4" class="text-center p-6 text-slate-400">
                                    Keine spezifischen Fahrzeiten definiert.
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>

        </div>
    </div>
</div>